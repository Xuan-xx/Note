# Session Cookie Token

## 产生原因

- 无状态的HTTP协议（协议对业务处理没有记忆能力

## 用途

- 提升用户体验

---

## Cookie

- 服务器发送到用户浏览器并**保存在本地**的一小块数据

- 用于告知服务器两次请求是否来自同一个浏览器

- 侧重信息储存，主要是客户端行为

  ### 用途

  1. 会话状态管理（登录状态
  2. 个性化设置
  3. 浏览器行为跟踪（分析用户行为

  ### 问题

  1. 被用于跨站请求伪造
  2. 有容量和数量限制
  3. 网络负载高



---

## Session

- 服务端行为
- 将用户的session存储到服务器，并生成一个Session-ID发送给客户端



### 交互流程

- 客户端第一次请求Session对象时，服务器为客户端创建一个Session，并通过特殊算法算出一个Session-ID用来表识该Session对象
- 当浏览器下一次发送请求时，会将Session-ID放到请求头中，服务器解析出Session-ID后，找到该Session来确定请求方的身份和上下文信息。



###　实现方式

- Cookie
- URL重写



### 存在问题

- 占用大量服务器空间
- 对分布式服务器实现方案复杂



---

## Token(令牌)

- 由服务器生成并发送给客户端，具有时效性的验证身份的手段
- 避免了Session的海量信息存储
- 避免了Cookie的一些安全性问题



### 简单的交互流程

- 客户端将用户的帐号和密码提交到服务器
- 服务器对齐校验，通过则用加密算法算出一个Token返回客户端
- 客户端将接收到的Token保存在本地，以后每次请求服务器时都携带该Token,提交给服务器进行身份校验
- 服务器收到请求后，解析关键信息，再根据相同的加密算法、密钥、用户参数生成sign与客户端的sign进行比较，一致则通过，否则拒绝服务
- 验证通过后服务端可以根据该Token中的uid获取对应的用户信息，进行业务请求的响应



### 设计思想

由三部分组成

- Header头部信息

  ​	记录了使用的加密算法信息

- Payload净荷信息

  ​	记录了用户信息和过期时间等

- Signature签名信息

  ​	根据上述两个信息生成

header和payload的信息不做加密，服务器接收到Token后剥离出Header和payload，通过自身密钥算出sign并与客户端传来的sign进行一致性对比



### 特点

- 可以跨站共享，实现单点登录
- 无需太多存储空间，Token包含了用户的信息，只需在客户端存储状态信息即可，对服务端的扩展性好
- 安全性依赖服务端的加密算法和密钥的安全性
- 不是万金油



---

## 总结

三者各有优缺点，常常结伴出现。