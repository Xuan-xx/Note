# Redis事务

- Redis中的事务与MySQL不同，Redis中的事务是一个隔离的过程，事务执行的过程中无法被其他指令中断。
- Redis事务的主要作用就是`串联`多个命令防止别的命令插队

## 事务的基本指令

- `multi` : 表示开始一个事务，后面输入的所有指令会进入一个等待执行的队列中
- `exec` : 表示执行事务中的所有指令
- `discard` : 表示放弃当前队列

## 事务的错误处理

1. 有一个指令在进入任务队列时就报错，则任务中的所有指令都不会执行
2. 一个指令在执行过程中才报错，则任务中其他指令会正常执行，报错的指令不正常执行

## 事务冲突的问题

### 悲观锁

- 每次去拿数据都认为修改数据会被修改，每次都会为数据上锁

### 乐观锁

- 每次去拿数据都认为数据不会被修改，所以不会上锁。但更新数据时会判断一下在此期间别人有没有去更新这个数据（使用版本号等机制）
- 这种机制适用于`多读`的应用类型，这样可以提高吞吐率。Redis就是利用这种check-and-set机制实现事务的

## WATCH key [key...]

- 在执行multi之前，先执行watch key1 [key2]，可以监视一个（或多个）key，如果在事务执行之前这个（或这些）key被其他命令所改动，那么事务将被打断。

## 三大特性

1. 单独的隔离操作

> 事务中的所有命令都会序列化，按顺序的执行。事务在执行过程中不会被其他客户端发送来的命令请求所打断
2. 没有隔离级别概念

> 队列中的命令没有提交之前不会实际被执行，因为事务提交前任何指令都不会实际执行
3. 不保证原子性

> 事务中如果有一条命令执行失败，其后的命令仍然会被执行，没有回滚